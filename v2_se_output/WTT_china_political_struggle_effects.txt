@SMALL_STATE_SUPPORT_VALUE = 5
@BIG_STATE_SUPPORT_VALUE = 9
@WARLORD_SUPPORT_VALUE = 5
WTT_setup_political_struggle = {
	if = {
		limit = {
			NOT = {
				any_country = { has_country_flag = wtt_political_struggle }
			}
		}
		set_variable = { global.days_add_support = 60 }
		set_variable = { global.days_remove_support = 60 }
		set_variable = { global.small_state_support_value = @SMALL_STATE_SUPPORT_VALUE }
		set_variable = { global.big_state_support_value = @BIG_STATE_SUPPORT_VALUE }
		325 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		594 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		595 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		597 = {
			set_variable = { state_political_support_value = @BIG_STATE_SUPPORT_VALUE }
		}
		602 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		603 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		604 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		605 = {
			set_variable = { state_political_support_value = @BIG_STATE_SUPPORT_VALUE }
		}
		608 = {
			set_variable = { state_political_support_value = @BIG_STATE_SUPPORT_VALUE }
		}
		613 = {
			set_variable = { state_political_support_value = @BIG_STATE_SUPPORT_VALUE }
		}
		615 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		617 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		620 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		622 = {
			set_variable = { state_political_support_value = @SMALL_STATE_SUPPORT_VALUE }
		}
		GXC = {
			set_variable = { warlord_political_support_value = @WARLORD_SUPPORT_VALUE }
		}
		YUN = {
			set_variable = { warlord_political_support_value = @WARLORD_SUPPORT_VALUE }
		}
		SHX = {
			set_variable = { warlord_political_support_value = @WARLORD_SUPPORT_VALUE }
		}
		XSM = {
			set_variable = { warlord_political_support_value = @WARLORD_SUPPORT_VALUE }
		}
		SIK = {
			set_variable = { warlord_political_support_value = @WARLORD_SUPPORT_VALUE }
		}
		event_target:WTT_current_china_leader = {
			WTT_save_country_as_event_target = yes
			set_country_flag = wtt_political_struggle
			every_state = {
				limit = { WTT_is_potential_political_struggle_state = yes }
				add_to_variable = { political_platform_@PREV = 1 }
				set_state_flag = majority_political_platform_@PREV
			}
		}
	}
}
WTT_restart_political_struggle = {
	event_target:WTT_current_china_leader = {
		set_country_flag = wtt_political_struggle
		clr_country_flag = wtt_political_struggle_paused
		WTT_save_country_as_event_target = yes
	}
	every_country = {
		limit = { has_country_flag = wtt_political_struggle_paused }
		WTT_save_country_as_event_target = yes
		set_country_flag = wtt_political_struggle
		clr_country_flag = wtt_political_struggle_paused
		every_owned_state = {
			limit = { is_core_of = ROOT }
			WTT_clear_political_platform_make_ROOT_majority = yes
		}
	}
	WTT_political_struggle_recalculate_support = yes
}
WTT_save_country_as_event_target = {
	if = {
		limit = { original_tag = CHI }
		save_global_event_target_as = scope_CHI
	}
	else_if = {
		limit = { original_tag = PRC }
		save_global_event_target_as = scope_PRC
	}
	else_if = {
		limit = { original_tag = GXC }
		save_global_event_target_as = scope_GXC
	}
	else_if = {
		limit = { original_tag = YUN }
		save_global_event_target_as = scope_YUN
	}
	else_if = {
		limit = { original_tag = SHX }
		save_global_event_target_as = scope_SHX
	}
	else_if = {
		limit = { original_tag = XSM }
		save_global_event_target_as = scope_XSM
	}
	else_if = {
		limit = { original_tag = SIK }
		save_global_event_target_as = scope_SIK
	}
}
WTT_clear_country_event_target = {
	if = {
		limit = { original_tag = CHI }
		clear_global_event_target = scope_CHI
	}
	else_if = {
		limit = { original_tag = PRC }
		clear_global_event_target = scope_PRC
	}
	else_if = {
		limit = { original_tag = GXC }
		clear_global_event_target = scope_GXC
	}
	else_if = {
		limit = { original_tag = YUN }
		clear_global_event_target = scope_YUN
	}
	else_if = {
		limit = { original_tag = SHX }
		clear_global_event_target = scope_SHX
	}
	else_if = {
		limit = { original_tag = XSM }
		clear_global_event_target = scope_XSM
	}
	else_if = {
		limit = { original_tag = SIK }
		clear_global_event_target = scope_SIK
	}
}
WTT_add_ROOT_to_political_struggle = {
	hidden_effect = {
		WTT_save_country_as_event_target = yes
		set_country_flag = wtt_political_struggle
		random_country = {
			limit = {
				ROOT = { has_country_flag = warlord_supports_@PREV }
			}
			ROOT = { clr_country_flag = warlord_supports_@PREV }
		}
		every_owned_state = {
			limit = { is_core_of = ROOT }
			WTT_clear_political_platform_make_ROOT_majority = yes
		}
	}
	WTT_political_struggle_recalculate_support = yes
}
WTT_clear_political_platform_make_ROOT_majority = {
	every_country = {
		limit = { is_literally_china = yes }
		clear_variable = PREV.political_platform_@THIS
		PREV = { clr_state_flag = majority_political_platform_@PREV }
	}
	set_state_flag = majority_political_platform_@ROOT
}
WTT_make_ROOT_majority_1_point_over_next = {
	random_country = {
		limit = {
			PREV = { has_state_flag = majority_political_platform_@PREV }
		}
		PREV = { clr_state_flag = majority_political_platform_@PREV }
		set_variable = { PREV.political_platform_@ROOT = PREV.political_platform_@THIS }
		add_to_variable = { PREV.political_platform_@ROOT = 1 }
	}
	set_state_flag = majority_political_platform_@ROOT
}
WTT_random_support_chance_increase_for_ROOT_in_state = {
	random_list = {
		65 = {
			add_to_variable = { political_platform_@ROOT = 1 }
			custom_effect_tooltip = increase_support_in_state_1
		}
		25 = {
			add_to_variable = { political_platform_@ROOT = 2 }
			custom_effect_tooltip = increase_support_in_state_2
		}
		10 = {
			add_to_variable = { political_platform_@ROOT = 3 }
			custom_effect_tooltip = increase_support_in_state_3
		}
	}
}
WTT_remove_opposition_state_support = {
	ROOT = {
		add_stability = -0.03
		custom_effect_tooltip = other_political_support_down_1
		subtract_from_variable = { other_political_support = 1 }
	}
	set_variable = { support_to_remove = 3 }
	if = {
		limit = {
			ROOT = { has_idea_with_trait = prince_of_terror }
		}
		add_to_variable = { support_to_remove = 2 }
	}
	if = {
		limit = {
			ROOT = { has_idea_with_trait = backroom_backstabber }
		}
		add_to_variable = { support_to_remove = 1 }
	}
	every_country = {
		limit = {
			has_country_flag = wtt_political_struggle
			NOT = { tag = ROOT }
		}
		custom_effect_tooltip = empty_key
		subtract_from_variable = { PREV.political_platform_@THIS = PREV.support_to_remove }
		clamp_variable = {
			var = PREV.political_platform_@THIS
			min = 0
		}
	}
	clear_variable = support_to_remove
	if = {
		limit = {
			NOT = {
				ROOT = { has_idea_with_trait = prince_of_terror }
				ROOT = { has_idea_with_trait = backroom_backstabber }
			}
		}
		custom_effect_tooltip = remove_support_in_state_3
	}
	else_if = {
		limit = {
			ROOT = { has_idea_with_trait = backroom_backstabber }
			NOT = {
				ROOT = { has_idea_with_trait = prince_of_terror }
			}
		}
		custom_effect_tooltip = remove_support_in_state_4
	}
	else_if = {
		limit = {
			NOT = {
				ROOT = { has_idea_with_trait = backroom_backstabber }
			}
			ROOT = { has_idea_with_trait = prince_of_terror }
		}
		custom_effect_tooltip = remove_support_in_state_5
	}
	else_if = {
		limit = {
			ROOT = { has_idea_with_trait = prince_of_terror }
			ROOT = { has_idea_with_trait = backroom_backstabber }
		}
		custom_effect_tooltip = remove_support_in_state_6
	}
}
WTT_recalculate_state_support_for_ROOT = {
	if = {
		limit = {
			any_other_country = {
				is_literally_china = yes
				NOT = { tag = ROOT }
				PREV = {
					check_variable = {
						var = political_platform_@PREV
						compare = greater_than_or_equals
						value = political_platform_@ROOT
					}
				}
			}
		}
	}
	else = {
		random_country = {
			limit = {
				PREV = { has_state_flag = majority_political_platform_@PREV }
			}
			PREV = { clr_state_flag = majority_political_platform_@PREV }
		}
		set_state_flag = majority_political_platform_@ROOT
	}
}
WTT_fire_add_support_status_events = {
	if = {
		limit = {
			has_state_flag = majority_political_platform_@ROOT
			event_target:majority_country = { tag = ROOT }
		}
		ROOT = {
			country_event = { id = wtt_political_organisation.1 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.2
					hours = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			has_state_flag = majority_political_platform_@ROOT
			event_target:majority_country = {
				NOT = { tag = ROOT }
			}
		}
		event_target:majority_country = { save_event_target_as = old_majority_country }
		ROOT = {
			save_event_target_as = majority_country
			country_event = { id = wtt_political_organisation.3 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.4
					hours = 1
				}
			}
		}
	}
	else = {
		ROOT = {
			country_event = { id = wtt_political_organisation.5 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.6
					hours = 1
				}
			}
		}
	}
}
WTT_fire_remove_support_status_events = {
	if = {
		limit = {
			has_state_flag = majority_political_platform_@ROOT
			event_target:majority_country = { tag = ROOT }
		}
		ROOT = {
			country_event = { id = wtt_political_organisation.7 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.8
					hours = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			has_state_flag = majority_political_platform_@ROOT
			event_target:majority_country = {
				NOT = { tag = ROOT }
			}
		}
		event_target:majority_country = { save_event_target_as = old_majority_country }
		ROOT = {
			save_event_target_as = majority_country
			country_event = { id = wtt_political_organisation.9 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.10
					hours = 1
				}
			}
		}
	}
	else = {
		ROOT = {
			country_event = { id = wtt_political_organisation.11 }
			every_other_country = {
				limit = { has_country_flag = wtt_political_struggle }
				country_event = {
					id = wtt_political_organisation.12
					hours = 1
				}
			}
		}
	}
}
WTT_political_struggle_recalculate_support = {
	hidden_effect = {
		every_country = {
			limit = { has_country_flag = wtt_political_struggle }
			clear_variable = total_political_support_points
		}
		every_state = {
			limit = {
				WTT_is_potential_political_struggle_state = yes
				OR = {
					is_controlled_by = event_target:WTT_current_china_leader
					CONTROLLER = { is_subject_of = event_target:WTT_current_china_leader }
					CONTROLLER = { has_country_flag = wtt_political_struggle }
				}
			}
			every_country = {
				limit = {
					has_country_flag = wtt_political_struggle
					PREV = { has_state_flag = majority_political_platform_@PREV }
				}
				add_to_variable = { total_political_support_points = PREV.state_political_support_value }
			}
		}
		every_country = {
			limit = { has_country_flag = wtt_political_struggle }
			every_country = {
				limit = { has_country_flag = warlord_supports_@PREV }
				add_to_variable = { PREV.total_political_support_points = warlord_political_support_value }
			}
		}
		every_country = {
			limit = { has_country_flag = wtt_political_struggle }
			add_to_variable = { total_political_support_points = other_political_support }
		}
	}
}
WTT_political_struggle_remove_current_country = {
	hidden_effect = {
		clr_country_flag = wtt_political_struggle
		clear_variable = total_political_support_points
		every_state = {
			limit = { WTT_is_potential_political_struggle_state = yes }
			clr_state_flag = majority_political_platform_@PREV
			clear_variable = political_platform_@PREV
		}
		WTT_clear_country_event_target = yes
	}
}
WTT_political_struggle_pause_current_country = {
	hidden_effect = {
		set_country_flag = wtt_political_struggle_paused
		WTT_clear_country_event_target = yes
	}
}
